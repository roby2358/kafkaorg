// Prisma schema for kafkaorg
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @db.VarChar(32)
  name          String         @db.VarChar(255)
  created       DateTime       @default(now())
  updated       DateTime       @updatedAt
  conversations Conversation[]

  @@map("users")
}

model Agent {
  id            Int            @id @default(autoincrement())
  name          String         @db.VarChar(256)
  topic         String         @db.VarChar(256)
  model         String         @db.VarChar(256)
  created       DateTime       @default(now())
  updated       DateTime       @updatedAt
  deleted       DateTime?
  active        Boolean
  conversations Conversation[]

  @@map("agents")
}

model Conversation {
  id          Int       @id @default(autoincrement())
  description String    @db.VarChar(1024)
  userId      String?   @map("user_id") @db.VarChar(32)
  agentId     Int       @map("agent_id")
  created     DateTime  @default(now())
  updated     DateTime  @updatedAt
  user        User?     @relation(fields: [userId], references: [id])
  agent       Agent     @relation(fields: [agentId], references: [id])

  @@map("conversations")
}

model DocmemNode {
  id           String        @id @db.VarChar(32)
  parentId     String?       @map("parent_id") @db.VarChar(32)
  text         String        @db.Text
  orderValue   Float         @map("order_value")
  tokenCount   Int           @map("token_count")
  createdAt    DateTime      @map("created_at") @default(now())
  updatedAt    DateTime      @map("updated_at") @updatedAt
  contextType  String        @map("context_type") @db.VarChar(24)
  contextName  String        @map("context_name") @db.VarChar(24)
  contextValue String        @map("context_value") @db.VarChar(24)
  readonly     Int           @default(0)
  hash         String?       @db.VarChar(128)
  parent       DocmemNode?   @relation("NodeHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children     DocmemNode[]  @relation("NodeHierarchy")

  @@index([parentId])
  @@index([parentId, orderValue])
  @@map("docmem_nodes")
}
